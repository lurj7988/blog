<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/blog/backend/video/qsvextract.html"><meta property="og:site_name" content="Original Tech"><meta property="og:title" content="QSV文件提取"><meta property="og:description" content="手撸Java提取QSV文件视频内容 QSV文件的构成详见上一篇文章，这篇文章带你手把手撸一遍代码。"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-05-17T09:23:02.000Z"><meta property="article:author" content="lurj"><meta property="article:tag" content="视频技术"><meta property="article:published_time" content="2023-03-02T00:00:00.000Z"><meta property="article:modified_time" content="2023-05-17T09:23:02.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"QSV文件提取","image":[""],"datePublished":"2023-03-02T00:00:00.000Z","dateModified":"2023-05-17T09:23:02.000Z","author":[{"@type":"Person","name":"lurj","url":"https://www.lurj7988.cn"}]}</script><link rel="icon" href="/blog/favicon.ico"><title>QSV文件提取 | Original Tech</title><meta name="description" content="手撸Java提取QSV文件视频内容 QSV文件的构成详见上一篇文章，这篇文章带你手把手撸一遍代码。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/blog/assets/style-a596d7ff.css" as="style"><link rel="stylesheet" href="/blog/assets/style-a596d7ff.css">
    <link rel="modulepreload" href="/blog/assets/app-87ad76aa.js"><link rel="modulepreload" href="/blog/assets/qsvextract.html-216c0d95.js"><link rel="modulepreload" href="/blog/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/blog/assets/qsvextract.html-b7d63464.js"><link rel="prefetch" href="/blog/assets/index.html-35a7ecee.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-fd14498c.js" as="script"><link rel="prefetch" href="/blog/assets/slides.html-296e1299.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-070d9e75.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c23bb801.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8c9a5738.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-2024bab7.js" as="script"><link rel="prefetch" href="/blog/assets/slides.html-50b7b43a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f3ad2b6b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-922ed310.js" as="script"><link rel="prefetch" href="/blog/assets/git.html-1c8cae99.js" as="script"><link rel="prefetch" href="/blog/assets/grafana.html-27fbe900.js" as="script"><link rel="prefetch" href="/blog/assets/medusa.html-025e4a36.js" as="script"><link rel="prefetch" href="/blog/assets/nmap.html-e1a761cc.js" as="script"><link rel="prefetch" href="/blog/assets/ssh.html-4fc2c807.js" as="script"><link rel="prefetch" href="/blog/assets/ubuntu.html-beb796c4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6928b175.js" as="script"><link rel="prefetch" href="/blog/assets/cmake.html-2400e577.js" as="script"><link rel="prefetch" href="/blog/assets/config.html-ef756134.js" as="script"><link rel="prefetch" href="/blog/assets/opencv.html-643d9905.js" as="script"><link rel="prefetch" href="/blog/assets/qsv.html-172169a8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6c8c684f.js" as="script"><link rel="prefetch" href="/blog/assets/disable.html-51af939e.js" as="script"><link rel="prefetch" href="/blog/assets/encrypt.html-c22585e5.js" as="script"><link rel="prefetch" href="/blog/assets/markdown.html-4f568a84.js" as="script"><link rel="prefetch" href="/blog/assets/page.html-9721d4e8.js" as="script"><link rel="prefetch" href="/blog/assets/cherry.html-e7d4fc01.js" as="script"><link rel="prefetch" href="/blog/assets/dragonfruit.html-6677e4fe.js" as="script"><link rel="prefetch" href="/blog/assets/strawberry.html-a9485621.js" as="script"><link rel="prefetch" href="/blog/assets/tomato.html-7962847d.js" as="script"><link rel="prefetch" href="/blog/assets/npm.html-a6802479.js" as="script"><link rel="prefetch" href="/blog/assets/nvm.html-dda6006c.js" as="script"><link rel="prefetch" href="/blog/assets/yarn.html-d0b32e7a.js" as="script"><link rel="prefetch" href="/blog/assets/gitlab-runner.html-b52d2df3.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-aa108914.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-dbb396dd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3d2f68f2.js" as="script"><link rel="prefetch" href="/blog/assets/gc.html-42b4592e.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-98879086.js" as="script"><link rel="prefetch" href="/blog/assets/surefire.html-e847af90.js" as="script"><link rel="prefetch" href="/blog/assets/tomcatembed.html-9e79a8f1.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-2a75fc73.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-a6627799.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-64e74fab.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-7e4aff54.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-7aaeee9c.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-2d64de1e.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-d9596433.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-507b9e1f.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-646a9d4b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-48517e6f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-29930afb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a9ace60a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-021abf34.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-30215db6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8d6a09d3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ab08ef82.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a457e8c8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4d707cb0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9adf3473.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-84ea5d97.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8ec862e9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c2a018cf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8a027e6f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-28d3c17d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-599bd0b4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d58ab746.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-027addd0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-eb83ce02.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a0288437.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cb37a111.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ebdf747a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ec0e4441.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ba222e08.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0ae8708c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5aec3eba.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2c879060.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1e3960b5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-129ea67c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-784f9e2c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-afc67370.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7853b5d2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9db9af20.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fe8d2fe0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a37571f2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-65fbeafe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4778ce8d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6caada12.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6aa0aa45.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bc0acdb7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-08d76149.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-53c36303.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-117fee16.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b4efb66f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-600b8c25.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7da9a634.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-076fab63.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-edc23c91.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8bd7c178.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d8cba2ba.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0bf2d500.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-abf50f62.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-24213814.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b935f2fa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-051de8c5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6ebaaf0e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2713b8b0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-624cbbeb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-921560e4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2da7a519.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-153f0b23.js" as="script"><link rel="prefetch" href="/blog/assets/slides.html-eb0d7f39.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bd7e063e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8546af96.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6f8efab4.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-6bf476fe.js" as="script"><link rel="prefetch" href="/blog/assets/slides.html-f0b04cca.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6228fa94.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f73ba2df.js" as="script"><link rel="prefetch" href="/blog/assets/git.html-c8f45a1d.js" as="script"><link rel="prefetch" href="/blog/assets/grafana.html-89e3c794.js" as="script"><link rel="prefetch" href="/blog/assets/medusa.html-d47f727b.js" as="script"><link rel="prefetch" href="/blog/assets/nmap.html-c2baba29.js" as="script"><link rel="prefetch" href="/blog/assets/ssh.html-f3da6882.js" as="script"><link rel="prefetch" href="/blog/assets/ubuntu.html-0ae9cef7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5e6384dd.js" as="script"><link rel="prefetch" href="/blog/assets/cmake.html-3e8a47f9.js" as="script"><link rel="prefetch" href="/blog/assets/config.html-e3cc1d93.js" as="script"><link rel="prefetch" href="/blog/assets/opencv.html-4a2edc8e.js" as="script"><link rel="prefetch" href="/blog/assets/qsv.html-55f10bd2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-edf59f1f.js" as="script"><link rel="prefetch" href="/blog/assets/disable.html-988478e7.js" as="script"><link rel="prefetch" href="/blog/assets/encrypt.html-dbc52b52.js" as="script"><link rel="prefetch" href="/blog/assets/markdown.html-aca36623.js" as="script"><link rel="prefetch" href="/blog/assets/page.html-0572521a.js" as="script"><link rel="prefetch" href="/blog/assets/cherry.html-9efea7f9.js" as="script"><link rel="prefetch" href="/blog/assets/dragonfruit.html-6984388c.js" as="script"><link rel="prefetch" href="/blog/assets/strawberry.html-b8fcf322.js" as="script"><link rel="prefetch" href="/blog/assets/tomato.html-be7e15fc.js" as="script"><link rel="prefetch" href="/blog/assets/npm.html-f2b4c2b0.js" as="script"><link rel="prefetch" href="/blog/assets/nvm.html-6f8b1f5c.js" as="script"><link rel="prefetch" href="/blog/assets/yarn.html-aebe214b.js" as="script"><link rel="prefetch" href="/blog/assets/gitlab-runner.html-f2d18133.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-32cb7cdf.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-156d6357.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7bb5ec55.js" as="script"><link rel="prefetch" href="/blog/assets/gc.html-e334ab06.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-2818f036.js" as="script"><link rel="prefetch" href="/blog/assets/surefire.html-0db24965.js" as="script"><link rel="prefetch" href="/blog/assets/tomcatembed.html-f4d63d7f.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-75958ca3.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-3a21760a.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-cbd55b9c.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-b51219c3.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-19c9e89d.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-2529267d.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-58333c18.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-5f2f67fb.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-2a680907.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e7097653.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-99eb8c9b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-570d4d72.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-12701796.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3cc0cc73.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-34327ab5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-973860e2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-91d4cbd7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-116a8e20.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e692f2bf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5033cf48.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-54feed52.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6778b040.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7594609a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8e1fdd4f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-32a43f72.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-36141383.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e7168c0b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a22c8d54.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8ddfd803.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f790040e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4b7a633a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1f6d06b3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-abc03834.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f4bcfd97.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e4028c2e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-baa4c0b6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2fd5cb94.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-840aa3ed.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a712c2c3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6de2a58d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-65fbb583.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-aff5506a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2a6bd00f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-af91ac06.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8b0c2d4e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1ed3475e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c91c326b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-537444a1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-58f5e06b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2bd1f477.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e227333a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-92140393.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-34275a26.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f3109db0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ebc2e903.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d7407831.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-eababf81.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-20bcb9c5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d6406a6d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0a3e98de.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e4896f35.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1602500a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-64038ca1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4218a18b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7c5e9d24.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-91e6073e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0292fcbb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-deffff89.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-52604b1e.js" as="script"><link rel="prefetch" href="/blog/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/blog/assets/index-ae8c1e74.js" as="script"><link rel="prefetch" href="/blog/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/blog/assets/mermaid.core-5042d226.js" as="script"><link rel="prefetch" href="/blog/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/blog/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/blog/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/blog/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/blog/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/blog/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/blog/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/blog/assets/VuePlayground-33b21a9b.js" as="script"><link rel="prefetch" href="/blog/assets/photoswipe.esm-2450701e.js" as="script"><link rel="prefetch" href="/blog/assets/SearchResult-5fb96e3e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/blog/" class="brand"><img class="logo light" src="/blog/assets/svg/logo.svg" alt="Original Tech"><img class="logo dark" src="/blog/assets/svg/logodark.svg" alt="Original Tech"><span class="site-name hide-in-pad">Original Tech</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="博客主页"><span class="font-icon icon iconfont icon-home" style=""></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/advanced/" class="nav-link" aria-label="前沿技术"><span class="font-icon icon iconfont icon-hot" style=""></span>前沿技术<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/frontend/" class="nav-link" aria-label="前端技术"><span class="font-icon icon iconfont icon-html" style=""></span>前端技术<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/backend/" class="nav-link active" aria-label="后端技术"><span class="font-icon icon iconfont icon-software" style=""></span>后端技术<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/ops/" class="nav-link" aria-label="测试运维"><span class="font-icon icon iconfont icon-linux" style=""></span>测试运维<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button type="button" class="dropdown-title" aria-label="选择语言"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/blog/en/" class="nav-link" aria-label="English"><!---->English<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html" class="router-link-active router-link-exact-active nav-link active" aria-label="简体中文"><!---->简体中文<!----></a></li></ul></button></div></div><div class="nav-item"><a class="repo-link" href="https://github.com/lurj7988/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/blog/backend/" class="nav-link sidebar-link sidebar-page" aria-label="后端技术"><!---->后端技术<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">java</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-c" style=""></span><span class="title">c++</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-play" style=""></span><span class="title">视频技术</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/blog/backend/video/qsv.html" class="nav-link sidebar-link sidebar-page" aria-label="QSV文件"><span class="font-icon icon iconfont icon-markdown" style=""></span>QSV文件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/blog/backend/video/qsvextract.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="QSV文件提取"><span class="font-icon icon iconfont icon-markdown" style=""></span>QSV文件提取<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#创建类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="创建类"><!---->创建类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#通用方法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="通用方法"><!---->通用方法<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#逐字节读取文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="逐字节读取文件"><!---->逐字节读取文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#字节数组转16进制字符串" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="字节数组转16进制字符串"><!---->字节数组转16进制字符串<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#字节数组转int" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="字节数组转int"><!---->字节数组转int<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#老版本解密算法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="老版本解密算法"><!---->老版本解密算法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#新版本解密算法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="新版本解密算法"><!---->新版本解密算法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#获取qsv头部信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="获取QSV头部信息"><!---->获取QSV头部信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#获取json数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="获取json数据"><!---->获取json数据<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#提取视频信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="提取视频信息"><!---->提取视频信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#参考资料" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="参考资料"><!---->参考资料<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/backend/video/qsvextract.html#往期系列" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="往期系列"><!---->往期系列<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon iconfont icon-markdown" style=""></span>QSV文件提取</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.lurj7988.cn" target="_blank" rel="noopener noreferrer">lurj</a></span><span property="author" content="lurj"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-03-02T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 12 分钟</span><meta property="timeRequired" content="PT12M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category8 clickable" role="navigation">后端技术</span><!--]--><meta property="articleSection" content="后端技术"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag6 clickable" role="navigation">视频技术</span><!--]--><meta property="keywords" content="视频技术"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><button type="button" class="copy-button" title="复制"><svg xmlns="http://www.w3.org/2000/svg" class="icon copy-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="copy icon"><path d="M853.333333 224h-53.333333V170.666667c0-40.533333-34.133333-74.666667-74.666667-74.666667H170.666667C130.133333 96 96 130.133333 96 170.666667v554.666666c0 40.533333 34.133333 74.666667 74.666667 74.666667h53.333333V853.333333c0 40.533333 34.133333 74.666667 74.666667 74.666667h554.666666c40.533333 0 74.666667-34.133333 74.666667-74.666667V298.666667c0-40.533333-34.133333-74.666667-74.666667-74.666667zM160 725.333333V170.666667c0-6.4 4.266667-10.666667 10.666667-10.666667h554.666666c6.4 0 10.666667 4.266667 10.666667 10.666667v554.666666c0 6.4-4.266667 10.666667-10.666667 10.666667H170.666667c-6.4 0-10.666667-4.266667-10.666667-10.666667z m704 128c0 6.4-4.266667 10.666667-10.666667 10.666667H298.666667c-6.4 0-10.666667-4.266667-10.666667-10.666667v-53.333333H725.333333c40.533333 0 74.666667-34.133333 74.666667-74.666667V288H853.333333c6.4 0 10.666667 4.266667 10.666667 10.666667v554.666666z M576 416h-96V320c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v96H320c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h96V576c0 17.066667 14.933333 32 32 32s32-14.933333 32-32v-96H576c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32z" fill="#666666"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#创建类" class="router-link-active router-link-exact-active toc-link level2">创建类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#通用方法" class="router-link-active router-link-exact-active toc-link level2">通用方法</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#逐字节读取文件" class="router-link-active router-link-exact-active toc-link level3">逐字节读取文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#字节数组转16进制字符串" class="router-link-active router-link-exact-active toc-link level3">字节数组转16进制字符串</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#字节数组转int" class="router-link-active router-link-exact-active toc-link level3">字节数组转int</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#老版本解密算法" class="router-link-active router-link-exact-active toc-link level2">老版本解密算法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#新版本解密算法" class="router-link-active router-link-exact-active toc-link level2">新版本解密算法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#获取qsv头部信息" class="router-link-active router-link-exact-active toc-link level2">获取QSV头部信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#获取json数据" class="router-link-active router-link-exact-active toc-link level2">获取json数据</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#提取视频信息" class="router-link-active router-link-exact-active toc-link level2">提取视频信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#参考资料" class="router-link-active router-link-exact-active toc-link level2">参考资料</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/backend/video/qsvextract.html#往期系列" class="router-link-active router-link-exact-active toc-link level2">往期系列</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="手撸java提取qsv文件视频内容" tabindex="-1"><a class="header-anchor" href="#手撸java提取qsv文件视频内容" aria-hidden="true">#</a> 手撸Java提取QSV文件视频内容</h1><p>QSV文件的构成详见上一篇文章，这篇文章带你手把手撸一遍代码。</p><!-- more --><h2 id="创建类" tabindex="-1"><a class="header-anchor" href="#创建类" aria-hidden="true">#</a> 创建类</h2><p>第一步新建一个java类<code>QSV</code>，构造函数传入需要解析的文件名称。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QSV</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token class-name">RandomAccessFile</span> randomAccessFile<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">QSV</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        randomAccessFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="通用方法" tabindex="-1"><a class="header-anchor" href="#通用方法" aria-hidden="true">#</a> 通用方法</h2><h3 id="逐字节读取文件" tabindex="-1"><a class="header-anchor" href="#逐字节读取文件" aria-hidden="true">#</a> 逐字节读取文件</h3><p>我们需要逐个字节读取文件，这边就需要jdk自带的类<code>RandomAccessFile</code>，先定义一个通用函数，输出偏移位置和字节大小获取字节数组。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* <span class="token keyword">@param</span> <span class="token parameter">offset</span> 偏移未知
* <span class="token keyword">@param</span> <span class="token parameter">size</span>   字节大小
* <span class="token keyword">@return</span> 字节数组
* <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
*/</span>
<span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//指针移动至偏移位置</span>
    randomAccessFile<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//需要读取的字节数</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
    randomAccessFile<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="字节数组转16进制字符串" tabindex="-1"><a class="header-anchor" href="#字节数组转16进制字符串" aria-hidden="true">#</a> 字节数组转16进制字符串</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">HEX_VOCABLE</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token char">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;2&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;3&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;4&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;5&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;6&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;7&#39;</span><span class="token punctuation">,</span>
        <span class="token char">&#39;8&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;9&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;A&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;B&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;C&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;D&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;E&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;F&#39;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
* 字节数组转16进制字符串
*
* <span class="token keyword">@param</span> <span class="token parameter">bs</span>
* <span class="token keyword">@return</span>
*/</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> b <span class="token operator">:</span> bs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> high <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> low <span class="token operator">=</span> b <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">HEX_VOCABLE</span><span class="token punctuation">[</span>high<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">HEX_VOCABLE</span><span class="token punctuation">[</span>low<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="字节数组转int" tabindex="-1"><a class="header-anchor" href="#字节数组转int" aria-hidden="true">#</a> 字节数组转int</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 字节数组转int
*
* <span class="token keyword">@param</span> <span class="token parameter">b</span>
* <span class="token keyword">@return</span>
*/</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">toInt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res <span class="token operator">+=</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="老版本解密算法" tabindex="-1"><a class="header-anchor" href="#老版本解密算法" aria-hidden="true">#</a> 老版本解密算法</h2><p>老版本解密方法比较简单，先看下C的写法：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">// 定义1个字节内存</span>
<span class="token keyword">typedef</span> <span class="token class-name">uint8_t</span> BYTE<span class="token punctuation">;</span>
<span class="token comment">// 定义4个字节内存</span>
<span class="token keyword">typedef</span> <span class="token class-name">uint32_t</span> DWORD<span class="token punctuation">;</span>
<span class="token comment">// decryption algorithm for some segments in qsv version 0x1</span>
<span class="token keyword">void</span> <span class="token function">decrypt_1</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span> buffer<span class="token punctuation">,</span> DWORD size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> BYTE dict<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DWORD j <span class="token operator">=</span> <span class="token operator">~</span>i <span class="token operator">&amp;</span> <span class="token number">0x3</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^=</span> dict<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以直接用byte数组和long类型替换c的内存定义，这边没问题时因为没有位移算法，后面新版本解密算法会讲到。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">decrypt_1</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bs<span class="token punctuation">,</span> <span class="token keyword">long</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//先取反再与运算</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token operator">~</span>i <span class="token operator">&amp;</span> <span class="token number">0x3</span><span class="token punctuation">;</span>
        <span class="token comment">//异或运算</span>
        bs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^=</span> b<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="新版本解密算法" tabindex="-1"><a class="header-anchor" href="#新版本解密算法" aria-hidden="true">#</a> 新版本解密算法</h2><p>新版本解密算法比较复杂，同样先看下c的写法：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">// 定义1个字节内存</span>
<span class="token keyword">typedef</span> <span class="token class-name">uint8_t</span> BYTE<span class="token punctuation">;</span>
<span class="token comment">// 定义4个字节内存</span>
<span class="token keyword">typedef</span> <span class="token class-name">uint32_t</span> DWORD<span class="token punctuation">;</span>
<span class="token comment">// decryption algorithm for some segments in qsv version 0x2</span>
<span class="token keyword">void</span> <span class="token function">decrypt_2</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span> buffer<span class="token punctuation">,</span> DWORD size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    DWORD x <span class="token operator">=</span> <span class="token number">0x62677079</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>DWORD i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;&gt;</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">^=</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>DWORD i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">^=</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;&lt;</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DWORD j <span class="token operator">=</span> x <span class="token operator">%</span> i<span class="token punctuation">;</span>
        BYTE tmp <span class="token operator">=</span> buffer<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp <span class="token operator">^</span> <span class="token punctuation">(</span>BYTE<span class="token punctuation">)</span><span class="token operator">~</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这边注意c的写法有位移，定义的<code>DWORD</code>占32位内存，而java与之对应的<code>int</code>类型也是占32位内存，取值范围是<code>-2^31~2^31-1</code>(即<code>-2147483648~2147483647</code>)，如果超出这个范围java需要用long，而long占64位内存取反和位移都是按64位进行的与C的32位取反位移计算结果肯定有差异。</p><p>比如：2147483648，转换位二进制表示：10000000000000000000000000000000，C的写法由于<code>DWORD</code>占32位内存，左移一位后超出32为故就变成00000000000000000000000000000000，而java已经超出了int的取值范围，只能用long定义，由于long占64位，左移一位不会超出，结果也就不一样了。</p><p>又比如：9147483648，转为二进制表示：1000100001001110111000011000000000，已经超出32位，存到<code>DWORD</code>中的只保留右边的32位，即00100001001110111000011000000000，左移以为变成01000010011101110000110000000000，转为10进制为1115098112，而java采用long定义不会超出64位，左移结果位10001000010011101110000110000000000，转为十进制表示为18294967296，与C的结果相差较大。那么有办法解决吗，答案肯定是有的，我们需要重新写一个位移算法。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 左移
*
* <span class="token keyword">@param</span> <span class="token parameter">value</span> long
* <span class="token keyword">@param</span> <span class="token parameter">i</span>     位移量
* <span class="token keyword">@return</span> long
*/</span>
<span class="token keyword">private</span> <span class="token keyword">long</span> <span class="token function">longLeftShift</span><span class="token punctuation">(</span><span class="token keyword">long</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> binary <span class="token operator">=</span> <span class="token function">format32</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    binary <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%0&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
* 右移
*
* <span class="token keyword">@param</span> <span class="token parameter">value</span> long
* <span class="token keyword">@param</span> <span class="token parameter">i</span>     位移量
* <span class="token keyword">@return</span> long
*/</span>
<span class="token keyword">private</span> <span class="token keyword">long</span> <span class="token function">longRightShift</span><span class="token punctuation">(</span><span class="token keyword">long</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> binary <span class="token operator">=</span> <span class="token function">format32</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    binary <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%0&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> binary<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> binary<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">format32</span><span class="token punctuation">(</span><span class="token keyword">long</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> binary <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">toBinaryString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>binary<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//补满32位</span>
        binary <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%0&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">-</span> binary<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> binary<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//多余的截取掉</span>
        binary <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>binary<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> binary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有了新定义的位移算法，解密算法就可以修改为：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">decrypt_2</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> x <span class="token operator">=</span> <span class="token number">0x62677079</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token function">longLeftShift</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">longRightShift</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">^=</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">^=</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> <span class="token function">longRightShift</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">longLeftShift</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span> tmp <span class="token operator">=</span> buffer<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>tmp <span class="token operator">^</span> <span class="token operator">~</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="获取qsv头部信息" tabindex="-1"><a class="header-anchor" href="#获取qsv头部信息" aria-hidden="true">#</a> 获取QSV头部信息</h2><p>上一篇文章讲到，头部信息共90个字节，<code>signature</code>(10byte)+<code>version</code>(4byte)+<code>vid</code>(16byte)+<code>_unknown1</code>(4byte)+<code>_unknown2</code>(32byte)+<code>_unknown3</code>(4byte)+<code>_unknown4</code>(4byte)+<code>json_offset</code>(8byte)+<code>json_size</code>(4byte)+<code>nb_indices</code>(4byte)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">QSV</span> qsv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QSV</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\workspace\\c\\风吹半夏第1集-蓝光1080P.qsv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qsv<span class="token punctuation">.</span><span class="token function">readHead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qsv<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readHead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//signature:10byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> signature <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0xA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//version:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> version <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0xA</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//vid:16byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> vid <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//_unknown1:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _unknown1 <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//_unknown2:32byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _unknown2 <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//_unknown3:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _unknown3 <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//_unknown4:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _unknown4 <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x46</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//json_offset:8byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> json_offset <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//json_size:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> json_size <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//nb_indices:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nb_indices <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;signature:%s\nversion:%s\nvid:%s\n_unknown1:%s\n_unknown2:%s\n_unknown3:%s\n_unknown4:%s\njson_offset:0x%s\njson_size:0x%s\nnb_indices:0x%s&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">toInt</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span>vid<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span>_unknown1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span>_unknown2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span>_unknown3<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">bytesToHex</span><span class="token punctuation">(</span>_unknown4<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>json_offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>json_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>nb_indices<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>signature:QIYI VIDEO
version:2
vid:A90EA47D4333331BB85F331C1130504C
_unknown1:01000000
_unknown2:0000000000000000000000000000000000000000000000000000000000000000
_unknown3:01000000
_unknown4:01000000
json_offset:0x167
json_size:0x1d81
nb_indices:0x7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="获取json数据" tabindex="-1"><a class="header-anchor" href="#获取json数据" aria-hidden="true">#</a> 获取json数据</h2><p>获取json数据需要先获取头部信息记录的json的偏移位置和字节大小，获取到的字节数组再通过老版本解密算法解密即可。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">QSV</span> qsv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QSV</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\workspace\\c\\风吹半夏第1集-蓝光1080P.qsv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qsv<span class="token punctuation">.</span><span class="token function">readJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qsv<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//json_offset:8byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> json_offset <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//json_size:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> json_size <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//json</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bs <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>json_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">toInt</span><span class="token punctuation">(</span>json_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">decrypt_1</span><span class="token punctuation">(</span>bs<span class="token punctuation">,</span> bs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;json_offset:0x%s\njson_size:0x%s&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>json_offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>json_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bs<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>json_offset:0x167
json_size:0x1d81
QYVI   {&quot;qsv_info&quot;:{&quot;ad&quot;:{},&quot;aid&quot;:&quot;3644740799867701&quot;,&quot;bid&quot;:600,&quot;dr&quot;:-1,&quot;independentaudio&quot;:true,&quot;m3u8&quot;:&quot;&quot;,&quot;pano&quot;:{&quot;type&quot;:1},&quot;qsvinfo_version&quot;:2,&quot;sdv&quot;:&quot;&quot;,&quot;st&quot;:&quot;&quot;,&quot;thdt&quot;:1,&quot;tht&quot;:0,&quot;title&quot;:&quot;&quot;,&quot;title_tail_info&quot;:{&quot;bt&quot;:99,&quot;bts&quot;:-1,&quot;et&quot;:2621,&quot;ete&quot;:-1,&quot;fe&quot;:1,&quot;le&quot;:0},&quot;tvid&quot;:&quot;3185901936393500&quot;,&quot;vd&quot;:{&quot;seg&quot;:{&quot;duration&quot;:[&quot;376140&quot;,&quot;365508&quot;,&quot;370300&quot;,&quot;371477&quot;,&quot;368311&quot;,&quot;368308&quot;,&quot;554319&quot;],&quot;rid&quot;:[&quot;a8c47c2906b88ae47e8503c96dae0494&quot;,&quot;4c8578cecbdfa3137a61b7e2bd1c68dc&quot;,&quot;4bc76f9b4d4ce995f40b42c467d206f8&quot;,&quot;8ed13ccd56aa2367f5eaabee12043d89&quot;,&quot;247b4612415c5b452f5965894a967e19&quot;,&quot;309400bef063cfd6baf19feb0d4a73a9&quot;,&quot;9771b1042cabfc9828767a3d0350f655&quot;],&quot;size&quot;:[&quot;75624801&quot;,&quot;84329329&quot;,&quot;90135782&quot;,&quot;82093900&quot;,&quot;91974933&quot;,&quot;75298884&quot;,&quot;111399115&quot;]},&quot;time&quot;:{&quot;et&quot;:&quot;2621000&quot;,&quot;st&quot;:&quot;99000&quot;}},&quot;vi&quot;:&quot;{\&quot;writer\&quot;:\&quot;\&quot;,\&quot;authors\&quot;:\&quot;\&quot;,\&quot;upOrder\&quot;:36,\&quot;rewardAllowed\&quot;:0,\&quot;fl\&quot;:[],\&quot;allowEditVVIqiyi\&quot;:0,\&quot;isPopup\&quot;:1,\&quot;payMark\&quot;:0,\&quot;an\&quot;:\&quot;风吹半夏\&quot;,\&quot;pvu\&quot;:\&quot;\&quot;,\&quot;subType\&quot;:1,\&quot;rewardMessage\&quot;:\&quot;\&quot;,\&quot;ipLimit\&quot;:1,\&quot;pubTime\&quot;:\&quot;1673306651000\&quot;,\&quot;mainActorRoles\&quot;:[],\&quot;up\&quot;:\&quot;2023-01-17 20:20:02\&quot;,\&quot;un\&quot;:\&quot;\&quot;,\&quot;qiyiProduced\&quot;:1,\&quot;platforms\&quot;:[],\&quot;vn\&quot;:\&quot;风吹半夏第1集\&quot;,\&quot;plc\&quot;:{\&quot;4\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;40\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;10\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;5\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;41\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;22\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;32\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;11\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;12\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;7\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;13\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;14\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;91\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;34\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;9\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;6\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;16\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;17\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;27\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;28\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;18\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;29\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;1\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;50\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;31\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;15\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;2\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;3\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;21\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;30\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;19\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;8\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1},\&quot;20\&quot;:{\&quot;downAld\&quot;:1,\&quot;coa\&quot;:1}},\&quot;sm\&quot;:0,\&quot;st\&quot;:200,\&quot;startTime\&quot;:99,\&quot;showChannelId\&quot;:2,\&quot;vu\&quot;:\&quot;http:\\/\\/www.iqiyi.com\\/v_uvxuws1kkw.html\&quot;,\&quot;povu\&quot;:\&quot;\&quot;,\&quot;ppsuploadid\&quot;:0,\&quot;qiyiPlayStrategy\&quot;:\&quot;非会员每日20:00转免1集\&quot;,\&quot;ar\&quot;:\&quot;内地\&quot;,\&quot;cc\&quot;:0,\&quot;videoQipuId\&quot;:3185901936393500,\&quot;albumQipuId\&quot;:3644740799867701,\&quot;pano\&quot;:{\&quot;type\&quot;:1},\&quot;subt\&quot;:\&quot;许半夏帮童骁骑驱霉运\&quot;,\&quot;endTime\&quot;:2621,\&quot;cpa\&quot;:1,\&quot;userVideocount\&quot;:0,\&quot;es\&quot;:36,\&quot;plg\&quot;:2774,\&quot;stl\&quot;:{\&quot;d\&quot;:\&quot;http:\\/\\/meta.video.iqiyi.com\&quot;,\&quot;stl\&quot;:[]},\&quot;subKey\&quot;:\&quot;3644740799867701\&quot;,\&quot;tvFocuse\&quot;:\&quot;赵丽颖欧豪携手创业\&quot;,\&quot;qtId\&quot;:0,\&quot;ty\&quot;:0,\&quot;ppsInfo\&quot;:{\&quot;shortTitle\&quot;:\&quot;风吹半夏第1集\&quot;,\&quot;name\&quot;:\&quot;风吹半夏第1集\&quot;},\&quot;sid\&quot;:0,\&quot;etm\&quot;:\&quot;\&quot;,\&quot;keyword\&quot;:\&quot;风吹半夏\&quot;,\&quot;pturl\&quot;:\&quot;\&quot;,\&quot;a\&quot;:\&quot;\&quot;,\&quot;isTopChart\&quot;:0,\&quot;idl\&quot;:0,\&quot;albumAlias\&quot;:\&quot;许半夏帮童骁骑驱霉运\&quot;,\&quot;stm\&quot;:\&quot;\&quot;,\&quot;pd\&quot;:1,\&quot;tags\&quot;:[],\&quot;coa\&quot;:0,\&quot;c\&quot;:2,\&quot;producers\&quot;:\&quot;\&quot;,\&quot;nurl\&quot;:\&quot;\&quot;,\&quot;tvEname\&quot;:\&quot;wild bloom\&quot;,\&quot;uid\&quot;:\&quot;0\&quot;,\&quot;asubt\&quot;:\&quot;\&quot;,\&quot;d\&quot;:\&quot;傅东育|毛溦\&quot;,\&quot;vid\&quot;:\&quot;a90ea47d4333331bb85f331c1130504c\&quot;,\&quot;dts\&quot;:\&quot;20230117202002\&quot;,\&quot;editorInfo\&quot;:\&quot;\&quot;,\&quot;tvSeason\&quot;:0,\&quot;ntvd\&quot;:3185901936393500,\&quot;vpic\&quot;:\&quot;http:\\/\\/pic6.iqiyipic.com\\/image\\/20221127\\/e2\\/52\\/v_170312139_m_601_m1.jpg\&quot;,\&quot;vType\&quot;:0,\&quot;cType\&quot;:1,\&quot;payMarkUrl\&quot;:\&quot;\&quot;,\&quot;apic\&quot;:\&quot;http:\\/\\/pic8.iqiyipic.com\\/image\\/20230104\\/6c\\/00\\/a_100498846_m_601_m26.jpg\&quot;,\&quot;shortTitle\&quot;:\&quot;风吹半夏第1集\&quot;,\&quot;tvid\&quot;:3185901936393500,\&quot;aid\&quot;:3644740799867701,\&quot;au\&quot;:\&quot;http:\\/\\/www.iqiyi.com\\/a_yq6d69gtw9.html\&quot;,\&quot;tvPhase\&quot;:0,\&quot;ifs\&quot;:0,\&quot;is\&quot;:0,\&quot;tpl\&quot;:[],\&quot;actors\&quot;:[],\&quot;isVip\&quot;:\&quot;\&quot;,\&quot;votes\&quot;:[],\&quot;previewImageUrl\&quot;:\&quot;http:\\/\\/preimage3.iqiyipic.com\\/preimage\\/20230110\\/6a\\/a6\\/v_170312139_m_611_m6.jpg\&quot;,\&quot;e\&quot;:\&quot;\&quot;,\&quot;cnPremTime\&quot;:0,\&quot;s\&quot;:\&quot;\&quot;,\&quot;ma\&quot;:\&quot;赵丽颖|欧豪|李光洁|刘威|柯蓝|任重|冯嘉怡|孙千|黄澄澄|是安|宋熹|王西|黄义威|王劲松|刘威葳|尤靖茹|林鹏（大陆男演员）|郝平|淮文|颜世魁|薛淑杰|刘硕|丁冠中|豆艺坤|寇钟吁|杨德民|傅宜箴|朱超艺|黄子琪|荣飞|田玲|周小镔|孔琳|方晓莉|陈创|韩朔|高远\&quot;,\&quot;supName\&quot;:\&quot;\&quot;,\&quot;sc\&quot;:0,\&quot;categoryKeywords\&quot;:\&quot;电视剧,3644740799867701,0,http:\\/\\/list.iqiyi.com\\/www\\/2\\/------------------.html 自制,12791537149997,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-12791537149997-----------------.html 浙江卫视,20291787825994,0,http:\\/\\/list.iqiyi.com\\/www\\/2\\/------------------.html 家庭,23757144288056,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-23757144288056-----------------.html 言情,23789230921965,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-23789230921965-----------------.html 励志,29717236536467,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-29717236536467-----------------.html 商战,32284167249109,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-32284167249109-----------------.html 剧情,37979544767779,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-37979544767779-----------------.html 都市,80141381722890,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-80141381722890-----------------.html 内地,80526421329786,0,http:\\/\\/list.iqiyi.com\\/www\\/2\\/------------------.html 爱情,87328787718281,2,http:\\/\\/list.iqiyi.com\\/www\\/2\\/-87328787718281-----------------.html\&quot;,\&quot;onlineStatus\&quot;:1,\&quot;mdown\&quot;:0,\&quot;bmsg\&quot;:{\&quot;t\&quot;:\&quot;20230117202002\&quot;,\&quot;f\&quot;:\&quot;web\&quot;,\&quot;mid\&quot;:\&quot;\&quot;,\&quot;sp\&quot;:\&quot;26173601,\&quot;},\&quot;nvid\&quot;:\&quot;8ec7f862076f40ee17c908e2bbc3fae2\&quot;,\&quot;flpps\&quot;:[],\&quot;supType\&quot;:\&quot;\&quot;,\&quot;lg\&quot;:2,\&quot;is3D\&quot;:0,\&quot;bossStatus\&quot;:0,\&quot;isDisplayCircle\&quot;:0,\&quot;actorRoles\&quot;:[],\&quot;exclusive\&quot;:1,\&quot;circle\&quot;:{\&quot;type\&quot;:0,\&quot;id\&quot;:0},\&quot;commentAllowed\&quot;:1,\&quot;tg\&quot;:\&quot;忠犬 大女主 自制 工业强国 毒舌 重组家庭 渣男 浙江卫视 家庭 言情 霸道总裁 御姐 励志 个人成长 虐恋 双强 普通话 商战 硬汉 剧情 出轨 兄弟反目 女强人 爽剧 初恋 青年奋斗 热血 女性励志 群像 个人奋斗 接地气 女青年 大佬 原生家庭 猪队友 都市 内地 组团 爱情\&quot;,\&quot;info\&quot;:\&quot;1996年的秋天，阳光炫目。许半夏开着一辆桑塔纳，接着刚出狱的童骁骑驶往鹭州出差。一路上童骁骑默默无言，二人之间气氛尴尬。到了酒店后，许半夏的指示很清楚：洗澡，看电视，睡觉，第二天一早，她来接童骁骑一起出差。童骁骑点点头，在许半夏离开后，他开始洗澡，记忆也回到了五年前……\\n1991年的一个雨夜，童骁骑因为急着给妈妈筹医药费，撬了一堆下水井盖，蹬着三轮车拉到了许半夏和小陈的废品站。小陈认定童骁骑就是个骗子，不愿帮忙，但善良的半夏相信童骁骑，给了他钱，并且三个人一大早一起把井盖都送了回去。童骁骑为表感激，愿意替二人做事。许半夏提到当地钢厂有很多废了的下脚料，他们可以去收，但缺一辆大车。于是司机班出身的童骁骑真的把厂里的东风偷偷开了出来，三人摇摇晃晃进了钢厂，挣到了人生的第一桶金，但童骁骑也因为私自用车被厂里开除了。回到废品站的童骁骑心灰意冷，许半夏却安慰道正好，今后他们三个人就一块儿干，而这些钱就是他们的第一笔合伙资金。\&quot;,\&quot;supId\&quot;:0,\&quot;issueTime\&quot;:0,\&quot;dtype\&quot;:3,\&quot;producer\&quot;:\&quot;\&quot;,\&quot;presentor\&quot;:[],\&quot;followerCount\&quot;:0}&quot;,&quot;vid&quot;:&quot;a90ea47d4333331bb85f331c1130504c&quot;,&quot;videotype&quot;:0}}s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="提取视频信息" tabindex="-1"><a class="header-anchor" href="#提取视频信息" aria-hidden="true">#</a> 提取视频信息</h2><p>获取视频信息，首先要先提取索引信息，根据索引信息中的偏移位置和字节大小获取，获取到的字节数组前1024个字节需要解密，根据头部信息中的<code>version</code>判断，如果是1则用老版本算法解密，如果是2则用新版本算法解密。</p><p>一个QSV文件包含多段视频数据，已发现的视频格式有flv（旧版客户端）、mpeg-ts（新版客户端）。可以通过前三个字节判断，如果前三个字节转字符串为<code>FLV</code>则为<code>FLV</code>格式。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">QSV</span> qsv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QSV</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\workspace\\c\\风吹半夏第1集-蓝光1080P.qsv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qsv<span class="token punctuation">.</span><span class="token function">readIndex</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\workspace\\c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qsv<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> outPath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//nb_indices</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nb_indices <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//索引</span>
    <span class="token comment">//_unknown_flag</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _unknown_flag <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token function">toInt</span><span class="token punctuation">(</span>nb_indices<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;nb_indices:0x%s\n_unknown_flag:%s&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>nb_indices<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span>_unknown_flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//version:4byte</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> version <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0xA</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//索引体</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> indices <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token number">0x5A</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>nb_indices<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">toInt</span><span class="token punctuation">(</span>nb_indices<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0x1C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">toInt</span><span class="token punctuation">(</span>nb_indices<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> indice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0x1C</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>indices<span class="token punctuation">,</span> <span class="token number">0x1C</span> <span class="token operator">*</span> i<span class="token punctuation">,</span> indice<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x1C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">decrypt_1</span><span class="token punctuation">(</span>indice<span class="token punctuation">,</span> indice<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">decrypt_2</span><span class="token punctuation">(</span>indice<span class="token punctuation">,</span> indice<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//索引体</span>
        <span class="token comment">//_codetable</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _codetable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0x10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>indice<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _codetable<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//segment_offset</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> segment_offset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0x8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>indice<span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> segment_offset<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//segment_size</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> segment_size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0x4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>indice<span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> segment_size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;_codetable:%s,segment_offset:0x%s,segment_size:0x%s&quot;</span><span class="token punctuation">,</span> <span class="token function">bytesToHex</span><span class="token punctuation">(</span>_codetable<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>segment_offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>segment_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exportVideo</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> segment_offset<span class="token punctuation">,</span> segment_size<span class="token punctuation">,</span> outPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">exportVideo</span><span class="token punctuation">(</span><span class="token keyword">int</span> fileindex<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> segment_offset<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> segment_size<span class="token punctuation">,</span> <span class="token class-name">String</span> outPath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> file <span class="token operator">=</span> <span class="token function">getByteFromFile</span><span class="token punctuation">(</span><span class="token function">toInt</span><span class="token punctuation">(</span>segment_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">toInt</span><span class="token punctuation">(</span>segment_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//前1024字节加密</span>
    <span class="token function">decrypt_2</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0x3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> head<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//System.out.println(new String(head));</span>
    <span class="token class-name">String</span> outname <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token class-name">File</span><span class="token punctuation">.</span>separator<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> outFile <span class="token operator">=</span> outPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> outname<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> outname<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-第&quot;</span> <span class="token operator">+</span> fileindex <span class="token operator">+</span> <span class="token string">&quot;段.&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RandomAccessFile</span> write <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>outFile<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;export:&quot;</span> <span class="token operator">+</span> outFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    write<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    write<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>nb_indices:0x7
_unknown_flag:7F
_codetable:A8C47C2906B88AE47E8503C96DAE0494,segment_offset:0x1ee8,segment_size:0x481f161
export:D:\workspace\c\风吹半夏第1集-蓝光1080P-第1段.flv
_codetable:4C8578CECBDFA3137A61B7E2BD1C68DC,segment_offset:0x4821049,segment_size:0x506c371
export:D:\workspace\c\风吹半夏第1集-蓝光1080P-第2段.flv
_codetable:4BC76F9B4D4CE995F40B42C467D206F8,segment_offset:0x988d3ba,segment_size:0x55f5ce6
export:D:\workspace\c\风吹半夏第1集-蓝光1080P-第3段.flv
_codetable:8ED13CCD56AA2367F5EAABEE12043D89,segment_offset:0xee830a0,segment_size:0x4e4a74c
export:D:\workspace\c\风吹半夏第1集-蓝光1080P-第4段.flv
_codetable:247B4612415C5B452F5965894A967E19,segment_offset:0x13ccd7ec,segment_size:0x57b6d15
export:D:\workspace\c\风吹半夏第1集-蓝光1080P-第5段.flv
_codetable:309400BEF063CFD6BAF19FEB0D4A73A9,segment_offset:0x19484501,segment_size:0x47cf844
export:D:\workspace\c\风吹半夏第1集-蓝光1080P-第6段.flv
_codetable:9771B1042CABFC9828767A3D0350F655,segment_offset:0x1dc53d45,segment_size:0x6a3d0cb
export:D:\workspace\c\风吹半夏第1集-蓝光1080P-第7段.flv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2><p>本文参考开源项目<code>qsv2flv</code>，项目地址：<a href="https://github.com/btnkij/qsv2flv.git" target="_blank" rel="noopener noreferrer">https://github.com/btnkij/qsv2flv.git<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>该项目采用<code>c</code>语言和<code>Qt</code>开发，本文作者根据原理采用<code>Java</code>进行了翻写，仅供学习和参考。如果要用于实际应用，请使用原项目提供的工具，可以将<code>qsv</code>文件转换为<code>flv</code>或<code>mp4</code>格式。</p><p>工具较大且<code>github</code>下载速度较慢，可以关注公众号<code>OriginalTech</code>回复QSV获取。</p><p><a href="https://mp.weixin.qq.com/s/2uKDdwMfUuJVNheaTTliXw" target="_blank" rel="noopener noreferrer">​查看原文<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="往期系列" tabindex="-1"><a class="header-anchor" href="#往期系列" aria-hidden="true">#</a> 往期系列</h2><p><a href="https://mp.weixin.qq.com/s/eYJgqZlqKIR3r3wXbqATfA" target="_blank" rel="noopener noreferrer">​揭秘爱奇艺qsv文件背后的秘密<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/lurj7988/blog/edit/main/docs/backend/video/qsvextract.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: naulurenjie@outlook.com">lurj</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/blog/backend/video/qsv.html" class="nav-link prev" aria-label="QSV文件"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon iconfont icon-markdown" style=""></span>QSV文件</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href="https://beian.miit.gov.cn/">苏ICP备2023002831号</a></div><div class="copyright">Copyright © 2023 lurj</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-87ad76aa.js" defer></script>
  </body>
</html>
